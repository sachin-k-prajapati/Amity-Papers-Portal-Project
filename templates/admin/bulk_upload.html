{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block title %}Bulk Upload | {{ site_title|default:_('Papers Portal Admin') }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .form-row {
            margin-bottom: 20px;
        }
        
        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin-top: 5px;
        }
        
        .help-text {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
        }
        
        .submit-row {
            padding: 15px 0;
            border-top: 1px solid #ddd;
            margin-top: 20px;
        }
    </style>
{% endblock %}

{% block content %}
<div id="content-main">
    <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        
        <div>
            <p class="help">Upload multiple files with automatic year and paper type detection from filenames.</p>
        </div>

        <fieldset class="module aligned">
            <div class="form-row">
                <div>
                    <label class="required" for="id_subject_offering">Subject offering:</label>
                    <select name="subject_offering" id="id_subject_offering" required>
                        <option value="">---------</option>
                        {% for offering in subject_offerings %}
                        <option value="{{ offering.id }}">
                            {{ offering.semester.program.institute.abbreviation }} - 
                            {{ offering.semester.program.name }} - 
                            Sem {{ offering.semester.number }} - 
                            {{ offering.subject.code }} ({{ offering.subject.name }})
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label class="required" for="id_files">Files:</label>
                    <div class="file-upload-area">
                        <input type="file" name="files" id="id_files" multiple accept=".pdf,.doc,.docx" required>
                        <p style="margin: 10px 0 0 0; color: #666;">
                            Select multiple PDF files (hold Ctrl/Cmd to select multiple)
                        </p>
                    </div>
                </div>
            </div>
        </fieldset>

        <div class="help-text">
            <h4>Automatic Detection:</h4>
            <ul>
                <li><strong>Year:</strong> Extracts 4-digit years (2020-2030) from filename</li>
                <li><strong>Paper Type:</strong> Detects keywords in filename:
                    <ul style="margin-top: 5px;">
                        <li>"back", "backpaper", "bp", "compartment", "reappear" → Back Paper</li>
                        <li>Default → End Sem</li>
                    </ul>
                </li>
                <li><strong>File Naming:</strong> Saves as "SUBJECTCODE_SUBJECTNAME_YEAR_TYPE_PROGRAM.pdf"</li>
            </ul>
        </div>

        <div class="help-text">
            <h4>Example:</h4>
            <p style="font-family: monospace; margin: 5px 0;">
                "Operating System Back Paper 2024.pdf" → CSE501_Operating_Systems_2024_Back_Paper_CSE.pdf
            </p>
        </div>

        <div class="submit-row">
            <input type="submit" value="Upload Files" class="default" />
            <a href="{% url 'admin:core_exampaper_changelist' %}" class="button">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
